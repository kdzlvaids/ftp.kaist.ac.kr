#!/usr/bin/env bash
# logs2clf -- Convert logs to CLF
# 
# See http://en.wikipedia.org/wiki/Common_Log_Format for CLF.
#  
# Created: 2008-02-14
# 
# Written by Jaeho Shin <netj@sparcs.org>.
# (C) 2008, Geoul Project. (http://ftp.kaist.ac.kr/geoul)
set -e

config=$1; shift || error "logs2clf: no config supplied"

if [ -r "$config" ]; then
    analyze() {
        local path=$1; shift
        local type=$1; shift

        converter=logs2clf.$type
        if type $converter &>/dev/null; then
            # TODO consider rotated situation
            PATH=$PATH:/usr/sbin
            logtail $path | $converter >&3
        else
            error "analyze: $type: unsupported log type"
        fi
    }
    . "$config" 3>&1 >/dev/null
else
    error "logs2clf: $config: Not found"
fi
