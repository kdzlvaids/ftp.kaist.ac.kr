#!/usr/bin/env bash
# geoul -- A mirror management solution
# 
# Written by Jaeho Shin <netj@sparcs.org>.
# (C) 2006-2009, Geoul Project. (http://project.sparcs.org/geoul)
set -e

GEOULSELF=`readlink -f "$0"`
GEOUL="`dirname "$GEOULSELF"`/"
export GEOULSELF GEOUL

export PATH="$GEOUL:$PATH"
export LC_ALL=C
export LANG=C
export LANGUAGE=C

[ -d "$GEOULDIR" ] || GEOULDIR=$PWD
export GEOULDIR

if Cmd=$1; shift; [ -n "$Cmd" -a -x "${GEOUL}$Cmd" ]; then
    # switch running user if defined
    eval `load-config owner`
    if [ -z "$owner" -o x"`whoami`" = x"$owner" ]; then
        exec "$Cmd" "$@"
    else
        exec sudo -H -u "$owner" env \
            GEOULDIR="$GEOULDIR" \
            GEOULDEBUG="$GEOULDEBUG" \
            "$GEOULSELF" "$Cmd" "$@"
    fi
else
    [ -z "$Cmd" ] || echo "$Cmd: unknown command" >&2
    echo "Try \`geoul help' for usage."
    exit 1
fi
